(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{CgF7:function(t,e,n){"use strict";n.r(e),n.d(e,"ChatModule",function(){return U});var o=n("ofXK"),s=n("FpXt"),c=n("tyNb"),a=n("IzEk"),i=n("fXoL"),r=n("3Pt+"),h=n("flj8"),g=n("mrSG"),b=n("utQ/"),u=n("2Vo4"),d=n("AytR");let l=(()=>{class t{constructor(t){this.ngZone=t,this.baseUrl=d.a.apiUrl,this.hubUrl=d.a.hubUrl,this.messageThreadSource=new u.a([]),this.messageThread$=this.messageThreadSource.asObservable()}createHubConnection(t,e){this.hubConnection=(new b.a).withUrl(this.hubUrl+"message?user="+e,{accessTokenFactory:()=>t.token}).withAutomaticReconnect().build(),this.hubConnection.start().catch(t=>console.log(t)),this.hubConnection.on("RecieveMessageThread",t=>{this.ngZone.run(()=>{console.log(t),this.messageThreadSource.next(t)})}),this.hubConnection.on("NewMessage",t=>{this.ngZone.run(()=>{console.log(t),this.messageThread$.pipe(Object(a.a)(1)).subscribe(e=>{this.messageThreadSource.next([...e,t])})})}),this.hubConnection.on("UpdatedGroup",t=>{this.ngZone.run(()=>{console.log(t),t.connections.some(t=>t.username==e)&&this.messageThread$.pipe(Object(a.a)(1)).subscribe(t=>{t.forEach(t=>{console.log(t),t.dateRead||(t.dateRead=new Date(Date.now()))}),this.messageThreadSource.next([...t])})})})}stopHubConnection(){this.hubConnection&&this.hubConnection.stop()}sendMessage(t,e){return Object(g.a)(this,void 0,void 0,function*(){return this.hubConnection.invoke("SendMessage",{recipientUsername:t,content:e}).catch(t=>console.log(t))})}}return t.\u0275fac=function(e){return new(e||t)(i.cc(i.E))},t.\u0275prov=i.Pb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var m=n("XiUz"),p=n("kmnG"),f=n("qFsG"),C=n("bTqV"),M=n("NFeN"),v=n("znSr"),O=n("Qu3c");const P=function(t){return{"mat-success":t}};function _(t,e){if(1&t&&(i.Yb(0,"div"),i.Yb(1,"div",10),i.Ub(2,"img",11),i.Xb(),i.Yb(3,"div",12),i.Yb(4,"div",13),i.Ic(5),i.Yb(6,"span",14),i.Ic(7),i.lc(8,"date"),i.Xb(),i.Yb(9,"mat-icon",15),i.Ic(10,"check"),i.Xb(),i.Xb(),i.Xb(),i.Xb()),2&t){const t=i.kc().$implicit;i.Gb(2),i.rc("src",t.senderPhotoUrl,i.Cc),i.Gb(3),i.Kc("",t.content," "),i.Gb(2),i.Jc(i.nc(8,5,t.messageSent,"shortDate")),i.Gb(2),i.qc("ngClass",i.tc(8,P,t.dateRead))("matTooltip",t.dateRead?"read":"unread")}}function x(t,e){if(1&t&&(i.Yb(0,"div"),i.Yb(1,"div",16),i.Ub(2,"img",11),i.Xb(),i.Yb(3,"div",17),i.Yb(4,"div",18),i.Yb(5,"div",19),i.Ic(6),i.Yb(7,"span",14),i.Ic(8),i.lc(9,"date"),i.Xb(),i.Xb(),i.Xb(),i.Xb(),i.Xb()),2&t){const t=i.kc().$implicit;i.Gb(2),i.rc("src",t.senderPhotoUrl,i.Cc),i.Gb(4),i.Kc("",t.content," "),i.Gb(2),i.Jc(i.nc(9,3,t.messageSent,"shortDate"))}}function y(t,e){if(1&t&&(i.Yb(0,"li"),i.Hc(1,_,11,10,"div",9),i.Hc(2,x,10,6,"div",9),i.Xb()),2&t){const t=e.$implicit,n=i.kc();i.Gb(1),i.qc("ngIf",t.senderUsername==n.user.username),i.Gb(1),i.qc("ngIf",t.senderUsername!==n.user.username)}}let X=(()=>{class t{constructor(t,e,n,o){var s,c;this.router=t,this.fb=e,this.accountService=n,this.chatService=o,this.pageNumber=1,this.pageSize=100,this.isLoading=!0,this.isChatLoading=!0,this.state=null===(c=null===(s=this.router.getCurrentNavigation())||void 0===s?void 0:s.extras)||void 0===c?void 0:c.state,this.accountService.currentUser$.pipe(Object(a.a)(1)).subscribe(t=>this.user=t),this.sendMessageForm=this.fb.group({content:[""]})}ngOnInit(){null==this.state?this.router.navigateByUrl("/members"):(this.otherUsername=this.state.username,this.getMessageThread())}ngOnDestroy(){console.log("destroy"),this.chatService.stopHubConnection()}getMessageThread(){this.chatService.createHubConnection(this.user,this.otherUsername)}sendMessage(){let t=this.sendMessageForm.get("content").value;this.chatService.sendMessage(this.otherUsername,t).then(()=>{this.sendMessageForm.reset()})}}return t.\u0275fac=function(e){return new(e||t)(i.Tb(c.b),i.Tb(r.c),i.Tb(h.a),i.Tb(l))},t.\u0275cmp=i.Nb({type:t,selectors:[["app-chat"]],decls:14,vars:6,consts:[["fxFlex","",1,"chat"],[1,"chat-history"],[1,"m-b-0"],[4,"ngFor","ngForOf"],[1,"send-btn"],[3,"formGroup"],["appearance","outline","fxFlex",""],["matInput","","formControlName","content"],["matSuffix","","mat-icon-button","",3,"click"],[4,"ngIf"],[1,"message-data","text-right"],["alt","avatar",3,"src"],["fxLayout","column","fxLayoutAlign","start end"],[1,"message","other-message","my-message","float-right"],[1,"message-data-time","text-xs","muted"],[1,"muted",3,"ngClass","matTooltip"],[1,"message-data"],["fxLayout","column"],[1,"message-content-container"],[1,"message","my-message"]],template:function(t,e){1&t&&(i.Yb(0,"div",0),i.Yb(1,"div",1),i.Yb(2,"ul",2),i.Hc(3,y,3,2,"li",3),i.lc(4,"async"),i.Xb(),i.Yb(5,"div",4),i.Yb(6,"form",5),i.Yb(7,"mat-form-field",6),i.Yb(8,"mat-label"),i.Ic(9,"send message"),i.Xb(),i.Ub(10,"input",7),i.Yb(11,"button",8),i.gc("click",function(){return e.sendMessage()}),i.Yb(12,"mat-icon"),i.Ic(13,"send"),i.Xb(),i.Xb(),i.Xb(),i.Xb(),i.Xb(),i.Xb(),i.Xb()),2&t&&(i.Gb(3),i.qc("ngForOf",i.mc(4,4,e.chatService.messageThread$)),i.Gb(2),i.Ec("max-width",360,"px"),i.Gb(1),i.qc("formGroup",e.sendMessageForm))},directives:[m.a,o.l,r.r,r.m,r.g,p.c,p.f,f.b,r.b,r.l,r.f,C.a,p.g,M.a,o.m,m.c,m.b,o.k,v.a,O.a],pipes:[o.b,o.e],styles:['img[_ngcontent-%COMP%]{width:70px;height:auto;border-radius:50%}.chat-sub-container[_ngcontent-%COMP%]{padding:5px 10px 5px 15px}.chat-member-panel[_ngcontent-%COMP%]:hover{background:#f7f7f7}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:20px;overflow:auto;height:72vh}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style:none;margin-bottom:35px}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{margin-bottom:0}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   .message-data[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:40px;width:40px}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   .message-data-time[_ngcontent-%COMP%]{padding-left:6px;position:absolute;bottom:-20px;right:0;min-width:100px;text-align:right}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{color:#292929;padding:15px;font-size:14px;border-radius:7px;display:inline-block;position:relative}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   .my-message[_ngcontent-%COMP%]{background:#efefef}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   .other-message[_ngcontent-%COMP%]{background:#e8f1f3;text-align:right}.chat[_ngcontent-%COMP%]   .chat-history[_ngcontent-%COMP%]   .other-message[_ngcontent-%COMP%]:after{border-bottom-color:#e8f1f3;left:93%}.chat[_ngcontent-%COMP%]   .chat-message[_ngcontent-%COMP%]{padding:20px}.chat[_ngcontent-%COMP%]   .message-content-container[_ngcontent-%COMP%]{position:relative}.chat[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{padding-left:20px}.float-right[_ngcontent-%COMP%]{float:right}.clearfix[_ngcontent-%COMP%]:after{visibility:hidden;display:block;font-size:0;content:" ";clear:both;height:0}']}),t})();const w=[{path:"/chat",component:X},{path:"",component:X}];let Y=(()=>{class t{}return t.\u0275mod=i.Rb({type:t}),t.\u0275inj=i.Qb({factory:function(e){return new(e||t)},imports:[[c.e.forChild(w)],c.e]}),t})(),U=(()=>{class t{}return t.\u0275mod=i.Rb({type:t}),t.\u0275inj=i.Qb({factory:function(e){return new(e||t)},imports:[[o.c,s.a,Y]]}),t})()},mrSG:function(t,e,n){"use strict";function o(t,e,n,o){return new(n||(n=Promise))(function(s,c){function a(t){try{r(o.next(t))}catch(e){c(e)}}function i(t){try{r(o.throw(t))}catch(e){c(e)}}function r(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,i)}r((o=o.apply(t,e||[])).next())})}n.d(e,"a",function(){return o})}}]);